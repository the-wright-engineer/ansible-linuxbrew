---

- name: Temporary directory
  file:
    path: "{{ linuxbrew_install_tmp }}"
    state: directory
  become: false

- name: Download Linuxbrew install script
  get_url:
    url: "{{ linuxbrew_install_url }}"
    dest: "{{ linuxbrew_install_tmp }}/install.sh"
    checksum: "{{ linuxbrew_install_checksum }}"
    mode: 0777
  become: false

- name: Install Linuxbrew
  command: sh -c "{{ linuxbrew_install_tmp }}/install.sh"
  register: install_result
  changed_when: "install_result.rc == 0"
  become: false

- name: Remove temporary directory
  file:
    path: "{{ linuxbrew_install_tmp }}"
    state: absent
  become: false

# Place brew binary in proper location and complete setup.
- name: Check if homebrew binary is already in place.
  stat:
    path: "{{ homebrew_brew_bin_path }}/brew"
  register: homebrew_binary
  check_mode: false

- name: Symlink brew to homebrew_brew_bin_path.
  file:
    src: "{{ homebrew_install_path }}/bin/brew"
    dest: "{{ homebrew_brew_bin_path }}/brew"
    state: link
  when: not homebrew_binary.stat.exists
  become: true